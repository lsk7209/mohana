# 기능 명세서

## 핵심 기능

### 1. 리드 관리 (CRM)

#### 리드 수집
- 랜딩 페이지 폼을 통한 리드 수집
- 중복 방지 (24시간 내 동일 이메일)
- Rate Limiting (IP 기반)
- 입력 검증 및 정제

#### 리드 관리
- 리드 목록 조회 (필터링, 검색, 페이징)
- 리드 상세 보기
- 상태 관리 (new, in_progress, quoted, won, lost, on_hold)
- 메모 및 태그 관리
- 리드 소유자 할당

#### 리드 스코어링
- 자동 스코어 계산
  - 이메일 오픈: +1점
  - 링크 클릭: +3점
  - 답장: +5점
  - 7일 미활동: -2점
- 핫리드 자동 태깅 (10점 이상)
- 스코어 히스토리 추적

### 2. 메시징 시스템

#### 이메일 발송
- 즉시 발송
- 예약 발송
- 템플릿 기반 발송
- 개인화 변수 지원
- 오픈/클릭 트래킹

#### SMS 발송
- 즉시 발송
- 템플릿 기반 발송
- 트래킹 링크 지원

#### 템플릿 관리
- 이메일/SMS 템플릿 CRUD
- 변수 시스템 ({{lead.name}}, {{company}} 등)
- 템플릿 미리보기
- A/B 테스트 준비

### 3. 시퀀스 자동화

#### 시퀀스 생성 및 편집
- 시퀀스 이름 설정
- 다중 스텝 구성
- 지연 시간 설정 (시간 단위)
- 조건부 발송 (미오픈/미클릭)
- 템플릿 선택

#### 시퀀스 실행
- 리드별 시퀀스 시작
- 자동 스케줄링 (Durable Objects)
- 조건 확인 및 스킵
- 다음 스텝 자동 진행

#### 웰컴 시퀀스
- 리드 생성 시 자동 시작
- 기본 템플릿 포함

### 4. 트래킹 및 분석

#### 오픈 트래킹
- 1x1 픽셀 이미지
- 중복 방지 (3초 내 동일 IP/UA)
- 이벤트 기록

#### 클릭 트래킹
- 링크 리디렉트
- UTM 파라미터 자동 추가
- 클릭 이벤트 기록

#### 통계 대시보드
- 일별 리드 수
- 일별 메시지 발송 수
- 오픈율/클릭율
- 핫리드 수
- 실시간 업데이트

### 5. Admin 대시보드

#### 대시보드
- 통계 개요 카드
- 통계 차트 (바/라인)
- 빠른 액션 버튼
- 리드 목록 미리보기

#### 리드 관리
- 리드 목록 (필터링, 검색, 페이징)
- 리드 상세 (타임라인, 메시지)
- 상태 변경
- 메모 작성
- 즉시 메시지 발송

#### 템플릿 관리
- 템플릿 목록
- 템플릿 생성/수정
- 템플릿 미리보기
- 템플릿 삭제

#### 시퀀스 관리
- 시퀀스 목록
- 시퀀스 생성/수정
- 시퀀스 실행

## 자동화 규칙

### 리드 스코어링
- 이벤트 발생 시 자동 업데이트
- 비활성 리드 스코어 감소 (크론)

### 리마인더
- 이메일 미오픈 48시간 후 SMS 리마인더

### 웰컴 시퀀스
- 리드 생성 시 자동 시작

## 보안 기능

### Rate Limiting
- IP 기반 요청 제한
- KV를 통한 분산 제한

### 입력 검증
- 이메일 형식 검증
- 전화번호 형식 검증
- XSS 방지 (입력 정제)

### HMAC 서명
- 트래킹 링크 서명 검증
- 위조 방지

## 성능 최적화

### 캐싱
- 템플릿 캐시 (KV)
- 트래킹 중복 방지 (KV)

### 비동기 처리
- 큐를 통한 메시지 발송
- 시퀀스 비동기 실행

### 페이징
- 리드 목록 페이징 (20개씩)
- 효율적인 쿼리

