name = "healingwork-platform"
main = "workers/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Cloudflare Pages 빌드 출력 디렉토리
pages_build_output_dir = ".next/out"

# D1 Database
# Pages 빌드에서는 필요하지 않으므로 주석 처리
# Workers 배포 시 아래 주석을 해제하고 ID를 입력하세요
# [[d1_databases]]
# binding = "DB"
# database_name = "healingwork-db"
# database_id = "" # 배포 시 생성된 ID로 교체

# KV Namespaces
# Pages 빌드에서는 필요하지 않으므로 주석 처리
# Workers 배포 시 아래 주석을 해제하고 ID를 입력하세요
# [[kv_namespaces]]
# binding = "CACHE"
# id = "" # 배포 시 생성된 ID로 교체

# [[kv_namespaces]]
# binding = "RATE_LIMIT"
# id = "" # 배포 시 생성된 ID로 교체

# Queues
[[queues.producers]]
queue = "email-dispatch"
binding = "EMAIL_QUEUE"

[[queues.consumers]]
queue = "email-dispatch"
max_batch_size = 10
max_batch_timeout = 30

[[queues.producers]]
queue = "sms-dispatch"
binding = "SMS_QUEUE"

[[queues.consumers]]
queue = "sms-dispatch"
max_batch_size = 10
max_batch_timeout = 30

[[queues.producers]]
queue = "retry-dispatch"
binding = "RETRY_QUEUE"

# Durable Objects
[[durable_objects.bindings]]
name = "SEQUENCE_SCHEDULER"
class_name = "SequenceScheduler"
script_name = "healingwork-platform"

[[migrations]]
tag = "v1"
new_classes = ["SequenceScheduler"]

# Cron Triggers
[triggers]
crons = [
  "*/5 * * * *",  # Queue 재시도 (5분마다)
  "0 * * * *",    # 시퀀스 스텝 스케줄링 (시간당)
  "5 0 * * *",    # 집계 ETL (매일 00:05)
  "15 0 * * 1"    # 링크 헬스 체크 (매주 월요일 00:15)
]

# Environment Variables (로컬 개발용)
[vars]
ENVIRONMENT = "development"

